<!DOCTYPE html>
<html lang="zh-TW">

<head>
  <meta charset="UTF-8">
  <meta
    name="viewport"
    content="width=device-width, initial-scale=1.0"
  >
  <title>Document</title>
</head>

<body>
  <div id="gameDiv">

  </div>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/pixi.js/5.0.2/pixi.min.js"></script>
  <script>
    let app
    let bgBack
    let bgMiddle
    let bgFront
    let bgX = 0
    let bgSpeed = -1

    window.onload = () => {
      app = new PIXI.Application({
        width: window.innerWidth,
        height: window.innerHeight,
      })

      document.querySelector('#gameDiv').appendChild(app.view)

      app.loader.baseUrl = 'img'
      app.loader
        .add('bgBack', "parallax-forest-back-trees.png")
        .add('bgMiddle', "parallax-forest-middle-trees.png")
        .add('bgFront', "parallax-forest-front-trees.png")
      app.loader.onComplete.add(initLevel)
      app.loader.load()

    }
    window.addEventListener('resize', resize)

    function resize() {

      _w = window.innerWidth
      _h = window.innerHeight

      app.renderer.resize(_w, _h)
    }

    function gameLoop(delta) {
      updateBg()
    }

    function initLevel() {
      bgBack = createBg(app.loader.resources['bgBack'].texture)
      bgMiddle = createBg(app.loader.resources['bgMiddle'].texture)
      bgFront = createBg(app.loader.resources['bgFront'].texture)

      app.ticker.add(gameLoop)

      document.addEventListener('keyup',
        switchDir)
    }

    function createBg(texture) {
      let tiling = new PIXI.TilingSprite(texture, 9999, 150)
      tiling.position.set(0, 0)
      tiling.scale.y = 2
      app.stage.addChild(tiling)

      return tiling
    }

    function updateBg() {
      bgX = (bgX + bgSpeed);
      bgFront.tilePosition.x = bgX
      bgMiddle.tilePosition.x = bgX / 2
      bgBack.tilePosition.x = bgX / 4
    }

    function switchDir(e) {
      console.log(e.keyCode);
      switch (e.keyCode) {
        case 37:
          //left
          bgSpeed = bgSpeed - 1
          break
        case 39:
          bgSpeed = bgSpeed + 1
          break
        case 32:
          bgSpeed = 0
          break
      }
    }
  </script>
</body>

</html>